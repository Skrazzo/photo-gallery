import { Flex, Container, Paper, Text, Input, Button } from '@mantine/core';
import { cleanNotificationsQueue, notifications } from '@mantine/notifications';
import { IconKey, IconUser } from '@tabler/icons-react';
import axios from 'axios';
import React, { useState } from 'react';

export default function Login() {
    const [loading, setLoading] = useState(false);

    function login(){
        setLoading(true);

        const params = object_to_urlsearchparams(get_form_object('login-cred'));
        axios.post('login.php', params).then(res => {
            if(res.status === 200){
                window.location.reload();
            }
        }).catch(err => {
            
            if(err.response.status === 403){
                notifications.show({
                    title: 'ERROR',
                    message: 'Username or password is incorrect!',
                    color: 'red'
                });
            }

            if(err.response.status === 400){
                notifications.show({
                    title: 'ERROR',
                    message: 'Huh? how tf did you send a request without username or password ...',
                    color: 'red'
                });
            }

            setLoading(false);
        });
    }

    function object_to_urlsearchparams(obj) {
        const params = new URLSearchParams();
      
        for (const key in obj) {
            if (obj.hasOwnProperty(key)) {
                params.append(key, obj[key]);
            }
        }
      
        return params;
    }
    
    // html form, to javascript object
    function get_form_object(formId) {
        const form = document.getElementById(formId);
        const formData = new FormData(form);
        const formDataObject = {};
      
        for (const [key, value] of formData.entries()) {
            formDataObject[key] = value;
        }
      
        return formDataObject;
    }

    return (
        <Container maw={375} p={0}>
            <Paper withBorder shadow={'sm'} p={'sm'}>
                <Flex align={'center'} justify={'space-between'}>
                    <svg width="196.95000000000002" height="23.42199415663148" viewBox="0 0 369.5483870967742 43.94800793690395" ><defs id="SvgjsDefs1197"></defs><g id="SvgjsG1198" featurekey="5TMTKC-0" transform="matrix(0.3963061370919019,0,0,0.3963061370919019,-11.66659072451927,-17.526603537051624)" fill="#111111"><g xmlns="http://www.w3.org/2000/svg"><path fill="#111111" d="M155.55,151.983c-0.203,0-0.408-0.012-0.615-0.035L36.366,138.229c-1.411-0.163-2.675-0.866-3.558-1.98   c-0.884-1.114-1.279-2.506-1.116-3.918l9.207-79.584c0.335-2.888,2.951-5.006,5.898-4.676l118.567,13.718   c2.914,0.337,5.013,2.983,4.676,5.899l-9.208,79.585C160.522,149.958,158.252,151.983,155.55,151.983z M46.184,51.036   c-1.178,0-2.168,0.884-2.304,2.057l-9.207,79.584c-0.071,0.615,0.102,1.223,0.486,1.708c0.386,0.486,0.937,0.793,1.552,0.864   l118.568,13.719c1.283,0.151,2.428-0.779,2.573-2.04l9.208-79.584c0.147-1.272-0.769-2.428-2.04-2.574L46.453,51.051   C46.363,51.041,46.273,51.036,46.184,51.036z"></path><path fill="#111111" d="M160.952,134.758c-0.828,0-1.506-0.672-1.506-1.5c0-0.766,0.568-1.397,1.309-1.488l6.223-1.134   c0.61-0.109,1.138-0.448,1.489-0.956c0.354-0.512,0.488-1.131,0.375-1.744l-5.339-29.269c-0.017-0.089-0.024-0.179-0.024-0.269   c0-0.829,0.672-1.506,1.5-1.506c0.765,0,1.396,0.567,1.488,1.306l5.326,29.196c0.259,1.401-0.047,2.821-0.86,3.995   c-0.811,1.169-2.026,1.949-3.424,2.198l-6.288,1.146C161.132,134.75,161.042,134.758,160.952,134.758z"></path><path fill="#111111" d="M158.415,63.994c-0.711,0-1.342-0.507-1.474-1.231l-2.484-13.635c-0.112-0.608-0.455-1.139-0.965-1.491   c-0.51-0.352-1.124-0.483-1.735-0.372l-34.293,5.934c-0.816,0.143-1.592-0.406-1.734-1.222c-0.141-0.816,0.406-1.593,1.223-1.734   l34.277-5.931c1.385-0.253,2.797,0.049,3.968,0.857c1.168,0.807,1.953,2.021,2.211,3.419l2.484,13.637   c0.148,0.815-0.392,1.596-1.207,1.745C158.595,63.986,158.505,63.994,158.415,63.994z"></path><path fill="#111111" d="M36.646,104.076c-0.71,0-1.342-0.507-1.474-1.23l-5.644-30.91c-0.258-1.396,0.045-2.811,0.854-3.981   c0.807-1.167,2.021-1.953,3.42-2.21l6.805-1.249c0.81-0.148,1.597,0.39,1.746,1.205c0.149,0.814-0.39,1.596-1.205,1.746   l-6.803,1.248c-0.611,0.112-1.143,0.456-1.495,0.966c-0.353,0.509-0.484,1.125-0.372,1.733l5.645,30.913   c0.148,0.815-0.392,1.597-1.206,1.745C36.827,104.068,36.736,104.076,36.646,104.076z"></path><path fill="#111111" d="M49.13,155.119c-1.071,0-2.116-0.325-3.019-0.949c-1.169-0.811-1.95-2.026-2.198-3.424l-2.369-12.988   c-0.148-0.815,0.392-1.597,1.206-1.745c0.814-0.147,1.597,0.391,1.745,1.206l2.37,12.995c0.108,0.611,0.447,1.138,0.955,1.49   c0.512,0.354,1.126,0.488,1.742,0.375l31.716-5.792c0.808-0.146,1.597,0.391,1.745,1.206s-0.392,1.597-1.206,1.745l-31.713,5.791   C49.779,155.09,49.453,155.119,49.13,155.119z"></path><path fill="#111111" d="M57.962,118.58c-0.496,0-0.981-0.246-1.267-0.695c-0.444-0.699-0.238-1.627,0.461-2.07l36.1-22.934   c0.701-0.443,1.627-0.238,2.07,0.462c0.444,0.699,0.238,1.626-0.461,2.07l-36.1,22.933C58.516,118.505,58.237,118.58,57.962,118.58   z"></path><path fill="#111111" d="M117.209,125.801c-0.45,0-0.896-0.202-1.19-0.587L92.871,95.06c-0.505-0.657-0.381-1.599,0.276-2.104   c0.656-0.505,1.599-0.381,2.103,0.276l23.147,30.155c0.505,0.657,0.381,1.599-0.276,2.103   C117.849,125.699,117.527,125.801,117.209,125.801z"></path><path fill="#111111" d="M104.13,108.764c-0.517,0-1.02-0.268-1.298-0.747c-0.416-0.716-0.173-1.634,0.544-2.05l13.079-7.597   c0.713-0.416,1.634-0.173,2.05,0.543s0.173,1.634-0.544,2.05l-13.079,7.597C104.646,108.698,104.386,108.764,104.13,108.764z"></path><path fill="#111111" d="M131.919,118.58c-0.427,0-0.851-0.181-1.146-0.532l-14.71-17.413c-0.535-0.633-0.455-1.579,0.178-2.114   c0.634-0.534,1.581-0.455,2.113,0.178l14.71,17.413c0.535,0.633,0.455,1.579-0.178,2.113   C132.604,118.464,132.261,118.58,131.919,118.58z"></path><path fill="#111111" d="M68.968,89.507c-6.185,0-11.216-5.031-11.216-11.215s5.031-11.215,11.216-11.215   c6.184,0,11.215,5.031,11.215,11.215S75.151,89.507,68.968,89.507z M68.968,70.077c-4.53,0-8.216,3.686-8.216,8.215   s3.686,8.215,8.216,8.215c4.529,0,8.215-3.686,8.215-8.215S73.497,70.077,68.968,70.077z"></path><path fill="#111111" d="M138.249,126.231c-0.411,0-0.82-0.168-1.116-0.497l-3.285-3.653c-0.554-0.616-0.504-1.564,0.112-2.118   c0.615-0.555,1.565-0.503,2.118,0.112l3.285,3.653c0.554,0.616,0.504,1.564-0.112,2.118   C138.965,126.104,138.605,126.231,138.249,126.231z"></path></g></g><g id="SvgjsG1199" featurekey="7UBp9i-0" transform="matrix(2.3551698537045556,0,0,2.3551698537045556,72.74986477084366,-12.471571069055758)" fill="#111111"><path d="M7.84 5.720000000000001 c1.52 0 2.72 0.41334 3.6 1.24 s1.32 1.94 1.32 3.34 c0 1.4133 -0.44 2.53 -1.32 3.35 s-2.0734 1.23 -3.58 1.23 l-3.34 0 l0 5.12 l-3.14 0 l0 -14.28 l6.46 0 z M7.02 12.440000000000001 c0.90666 0 1.5833 -0.16666 2.03 -0.5 s0.67 -0.88 0.67 -1.64 c0 -0.73334 -0.21666 -1.2733 -0.65 -1.62 s-1.11 -0.52 -2.03 -0.52 l-2.52 0 l0 4.28 l2.5 0 z M17.259999999999998 5.720000000000001 l0 5.38 l0.06 0 c0.32 -0.53334 0.75334 -0.95334 1.3 -1.26 s1.1267 -0.46 1.74 -0.46 c1.32 0 2.2766 0.33334 2.87 1 s0.89 1.72 0.89 3.16 l0 6.46 l-2.84 0 l0 -5.88 c0 -0.84 -0.13666 -1.4667 -0.41 -1.88 s-0.74334 -0.62 -1.41 -0.62 c-0.76 0 -1.3167 0.23 -1.67 0.69 s-0.53 1.2167 -0.53 2.27 l0 5.42 l-2.84 0 l0 -14.28 l2.84 0 z M31.299999999999997 9.38 c1.6533 0 2.96 0.50334 3.92 1.51 s1.44 2.3234 1.44 3.95 c0 1.64 -0.49 2.9566 -1.47 3.95 s-2.2766 1.49 -3.89 1.49 c-1.64 0 -2.94 -0.50334 -3.9 -1.51 s-1.44 -2.3166 -1.44 -3.93 c0 -1.6667 0.49 -2.9934 1.47 -3.98 s2.27 -1.48 3.87 -1.48 z M28.8 14.84 c0 1.0533 0.21334 1.8666 0.64 2.44 s1.0467 0.86 1.86 0.86 c0.84 0 1.47 -0.29334 1.89 -0.88 s0.63 -1.3933 0.63 -2.42 c0 -1.0667 -0.21666 -1.8867 -0.65 -2.46 s-1.0633 -0.86 -1.89 -0.86 c-0.8 0 -1.4133 0.28666 -1.84 0.86 s-0.64 1.3933 -0.64 2.46 z M42.1 6.5600000000000005 l0.000019531 3.1 l2.08 0 l0 1.9 l-2.08 0 l0 5.12 c0 0.48 0.08 0.8 0.24 0.96 s0.48 0.24 0.96 0.24 c0.34666 0 0.64 -0.02666 0.88 -0.08 l0 2.22 c-0.4 0.06666 -0.96 0.1 -1.68 0.1 c-1.0933 0 -1.9067 -0.18666 -2.44 -0.56 s-0.8 -1.02 -0.8 -1.94 l0 -6.06 l-1.72 0 l0 -1.9 l1.72 0 l0 -3.1 l2.84 0 z M50.56 9.38 c1.6533 0 2.96 0.50334 3.92 1.51 s1.44 2.3234 1.44 3.95 c0 1.64 -0.49 2.9566 -1.47 3.95 s-2.2766 1.49 -3.89 1.49 c-1.64 0 -2.94 -0.50334 -3.9 -1.51 s-1.44 -2.3166 -1.44 -3.93 c0 -1.6667 0.49 -2.9934 1.47 -3.98 s2.27 -1.48 3.87 -1.48 z M48.06 14.84 c0 1.0533 0.21334 1.8666 0.64 2.44 s1.0467 0.86 1.86 0.86 c0.84 0 1.47 -0.29334 1.89 -0.88 s0.63 -1.3933 0.63 -2.42 c0 -1.0667 -0.21666 -1.8867 -0.65 -2.46 s-1.0633 -0.86 -1.89 -0.86 c-0.8 0 -1.4133 0.28666 -1.84 0.86 s-0.64 1.3933 -0.64 2.46 z M67.44 9.38 c1.4267 0 2.4534 0.55332 3.08 1.66 l0.04 0 l0 -1.38 l2.7 0 l0 9.7 c0 1.4933 -0.46334 2.6266 -1.39 3.4 s-2.2434 1.16 -3.95 1.16 c-1.3067 0 -2.3834 -0.31334 -3.23 -0.94 s-1.2967 -1.42 -1.35 -2.38 l2.82 0 c0.22666 0.94666 0.93332 1.42 2.12 1.42 c0.73334 0 1.2967 -0.21666 1.69 -0.65 s0.59 -1.05 0.59 -1.85 l0 -1.42 l-0.04 0 c-0.28 0.50666 -0.69 0.9 -1.23 1.18 s-1.1633 0.42 -1.87 0.42 c-1.3867 0 -2.47 -0.45334 -3.25 -1.36 s-1.17 -2.1866 -1.17 -3.84 c0 -1.4667 0.41 -2.6866 1.23 -3.66 s1.89 -1.46 3.21 -1.46 z M65.84 14.46 c0 0.97334 0.20336 1.7333 0.61002 2.28 s0.97 0.82 1.69 0.82 c0.73334 0 1.32 -0.26334 1.76 -0.79 s0.66 -1.2233 0.66 -2.09 c0 -1.04 -0.21 -1.8267 -0.63 -2.36 s-1.0233 -0.8 -1.81 -0.8 c-0.73334 0 -1.2967 0.27666 -1.69 0.83 s-0.59 1.2567 -0.59 2.11 z M80.30000000000001 9.38 c3.0134 0.01334 4.52 0.9933 4.52 2.94 l0 5.48 c0 1.0133 0.12 1.7467 0.36 2.2 l-2.88 0 c-0.10666 -0.32 -0.17332 -0.65334 -0.19998 -1 c-0.84 0.85334 -2 1.28 -3.48 1.28 c-1.08 0 -1.9367 -0.27334 -2.57 -0.82 s-0.95 -1.3067 -0.95 -2.28 c0 -0.94666 0.3 -1.68 0.9 -2.2 c0.61334 -0.54666 1.7267 -0.89332 3.34 -1.04 c1.1467 -0.12 1.8733 -0.27 2.18 -0.45 s0.46 -0.45666 0.46 -0.83 c0 -0.46666 -0.14 -0.81332 -0.42 -1.04 s-0.74666 -0.34 -1.4 -0.34 c-0.6 0 -1.0533 0.12334 -1.36 0.37 s-0.48666 0.64332 -0.54 1.19 l-2.84 0 c0.06666 -1.1333 0.53332 -1.9933 1.4 -2.58 s2.0266 -0.88 3.48 -0.88 z M77.94000000000001 17.06 c0 0.88 0.58 1.32 1.74 1.32 c1.52 -0.01334 2.2866 -0.79334 2.3 -2.34 l0 -1.1 c-0.22666 0.22666 -0.8 0.39332 -1.72 0.49998 c-0.8 0.09334 -1.3867 0.25668 -1.76 0.49002 s-0.56 0.61 -0.56 1.13 z M89.94000000000001 5.720000000000001 l0 14.28 l-2.84 0 l0 -14.28 l2.84 0 z M95.10000000000001 5.720000000000001 l0 14.28 l-2.84 0 l0 -14.28 l2.84 0 z M102.12 9.38 c0.97334 0 1.84 0.22664 2.6 0.67998 s1.3567 1.11 1.79 1.97 s0.65 1.85 0.65 2.97 c0 0.10666 -0.0066602 0.28 -0.02 0.52 l-7.46 0 c0.02666 0.82666 0.24332 1.47 0.64998 1.93 s1.03 0.69 1.87 0.69 c0.52 0 0.99666 -0.13 1.43 -0.39 s0.71 -0.57666 0.83 -0.95 l2.5 0 c-0.73334 2.32 -2.3466 3.48 -4.84 3.48 c-0.94666 -0.01334 -1.8233 -0.22 -2.63 -0.62 s-1.45 -1.0233 -1.93 -1.87 s-0.72 -1.83 -0.72 -2.95 c0 -1.0533 0.24334 -2.0134 0.73 -2.88 s1.1333 -1.5133 1.94 -1.94 s1.6767 -0.64 2.61 -0.64 z M104.30000000000001 13.719999999999999 c-0.13334 -0.77334 -0.38 -1.3333 -0.74 -1.68 s-0.87334 -0.52 -1.54 -0.52 c-0.69334 0 -1.24 0.19666 -1.64 0.59 s-0.63334 0.93 -0.7 1.61 l4.62 0 z M114.86000000000001 9.38 c0.24 0 0.44668 0.03334 0.62002 0.1 l0 2.64 c-0.30666 -0.06666 -0.64666 -0.1 -1.02 -0.1 c-1.8667 0 -2.8 1.1067 -2.8 3.32 l0 4.66 l-2.84 0 l0 -10.34 l2.7 0 l0 1.92 l0.04 0 c0.28 -0.66666 0.72334 -1.2 1.33 -1.6 s1.2633 -0.6 1.97 -0.6 z M118.44000000000001 9.66 l2.34 7.08 l0.04 0 l2.26 -7.08 l2.94 0 l-4.32 11.64 c-0.30666 0.81334 -0.73 1.4067 -1.27 1.78 s-1.29 0.56 -2.25 0.56 c-0.41334 0 -1.0067 -0.03334 -1.78 -0.1 l0 -2.34 c0.50666 0.06666 1.0067 0.1 1.5 0.1 c0.4 0 0.71 -0.12334 0.93 -0.37 s0.33 -0.55666 0.33 -0.93 c0 -0.21334 -0.04 -0.42668 -0.12 -0.64002 l-3.64 -9.7 l3.04 0 z"></path></g></svg>
                    <Text c={'dimmed'} fs={'italic'}>{window.version}</Text>
                </Flex>

                <form id={'login-cred'}>
                    <Flex gap={5} mt={15} direction={'column'}>
                        <Input name='username' icon={<IconUser />} placeholder='Username'/>
                        <Input name='password' icon={<IconKey />} type={'password'} placeholder='Password'/>
                    </Flex>

                </form>

                <Button loading={loading} onClick={login} mt={5} variant={'light'}>Login</Button>
            </Paper>
            
        </Container>
    )
}
